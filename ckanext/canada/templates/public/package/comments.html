<section class="indent-large">
<div class="span-6 margin-top-medium">
    {%- set pkg = c.pkg_dict -%}
    {%- set comment_list = h.dataset_comments(request, c, pkg.id, h.lang()) -%}

    {%- if comment_list -%}
      <div class="row">
        <div class="col-md-4"><h4 style="display:inline-block;">{{ _('Comments') }}({{ c.page.item_count }} )</h4></div>

        {% block page_pagination_top %}
          <div class="col-md-4"><small>{{ c.page.pager(q=c.q) }}</small></div>
         {% endblock %}

        <div class="text-right"><small>
          <form class="form-inline mrgn-bttm-sm mrgn-tp-md form-group form-horizontal" role="form" method="get" >
            <select id="field-page-limit" name="pagelimit" class="form-control input-sm" onchange="this.form.submit()">
              {% for value in [20, 50, 100] %}
                <option value="{{ value }}" {% if c.pagelimit==value %} selected="selected"{% endif %}>{{ value }}</option>
              {% endfor %}
            </select>
            <label for="field-page-limit" class="control-label">{{ _('Per Page') }}</label>
          </form>
        </small></div>
      </div>
      {% set previous_thread = [] %}
      {% for comment in comment_list %}
        {% set thread = comment['thread'].split('.') %}
        {% if thread|length > previous_thread|length and previous_thread|length > 0 %}
            <div class="indented">
        {% elif thread|length < previous_thread|length %}
            {% for step in range(previous_thread|length - thread|length) %}
                </div>
            {% endfor %}
        {% endif %}
        <article class="comment ">
          <header><p class="author-datetime"><span class="comment-author">{{ comment['user']}}</span> - <span class="comment-datetime">{{ comment['date'] }}</span></p></header>
          <p>{{ comment['comment_body']|striptags }}</p>
        </article>
       {% set previous_thread = thread %}
      {% endfor %}

      {% block page_pagination %}
      {{ c.page.pager(q=c.q) }}
      {% endblock %}
    {% else %}
      <h4>{{ _('Comments') }}(0)</h4>
    {%- endif -%}
    <div class="margin-top-medium">
      <a href="/{% if h.lang() == 'fr' %}fr{% else %}en{% endif %}/dataset/{{pkg.name}}"
          class="btn btn-default btn-lg">{{_('Comment')}}</a>
    </div>
</div>
</section>
