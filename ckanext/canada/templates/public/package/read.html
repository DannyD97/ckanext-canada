{# vim: set filetype=jinja sw=2 sts=2: #}
{% ckan_extends %}
{% import 'macros/canada_read.html' as cr %}

{% set pkg = c.pkg_dict %}
{% set client_lang = h.lang() %}
{% set wet_server = h.wet_url() %}

{% block subtitle %}{{ cr.field_id('title', pkg, client_lang) or pkg.name }}{% endblock %}

{% block package_item_title %}
{% if pkg.state.startswith('draft') %}
  <div class="col-md-12">
    <h3>[{{ _('Draft') }}]</h3>
  </div>
{% endif %}
{% endblock %}

{% block package_item_notes %}
{% if c.pkg_notes_formatted %}
  <div class="col-md-12">
    {{ cr.field_id('notes', pkg, client_lang) }}
  </div>
{% endif %}
{% endblock %}

{% block package_item_license_inner %}
{# for now, just override the old data.gc.ca license
   url until such time that all datasets have been
   updated with the new url #}

{% if client_lang == 'fr' %}
  {% if pkg.license_url_fra == 'http://data.gc.ca/fra/licence-du-gouvernement-ouvert-canada' %}
      {% set license_url_fra = 'â€‹http://ouvert.canada.ca/fr/licence-du-gouvernement-ouvert-canada' %}
  {% else %}
      {% set license_url_fra = pkg.license_url_fra %}
  {% endif %}
  <a href="{{ license_url_fra }}">{{ pkg.license_title_fra }}</a>
{% else %}
  {% if pkg.license_url == 'http://data.gc.ca/eng/open-government-licence-canada' %}
      {% set license_url = 'http://open.canada.ca/en/open-government-licence-canada' %}
  {% else %}
      {% set license_url_fra = pkg.license_url %}
  {% endif %}
  <a href="{{ license_url }}">{{ pkg.license_title }}</a>
{% endif %}
{% endblock %}

{% block package_item_apps %}
<div class="col-md-12">
  {% set apps = [] %}
  {% for resource in pkg.resources %}
    {% if resource.format == 'app' %}
      {% do apps.append(resource) %}
    {% endif %}
  {% endfor %}
</div>
{% endblock %}

{% if apps|length > 0 %}
<div class="col-md-12">
  <h4>{{ _('Related Items') }}</h4>
  <ul class="list-unstyled">
  {% for resource in apps %}
    {% snippet 'package/snippets/app_item.html',
        pkg=pkg, res=resource, res_num=loop.index, client_lang=client_lang %}
  {% endfor %}
  </ul>
</div>
{% endif %}

{% block package_item_geo_preview %}
{% if pkg.geographic_region or pkg.spatial %}
<div class="col-md-12">
  <h4>{{ _('Geographic Information') }}</h4>
  {% if pkg.spatial %}
    {% set wkt = h.geojson_to_wkt(pkg.spatial) %}
    {% if wkt %}
      {% if h.get_map_type() == 'static' %}

        {% snippet 'snippets/geomap_static.html', gid=cr.field_id('title', pkg, client_lang), wkt=wkt %}
      {% else %}
        {% snippet 'snippets/geomap_dynamic.html', gid=cr.field_id('title', pkg, client_lang), wkt=wkt %}
      {% endif %}
    {% endif %}
  {% endif %}
  {% if pkg.geographic_region %}
    {% set geo_region = schema_description.dataset_field_by_id['geographic_region'] %}

      <div class="col-md-4">
        <h4>{{ cr.field_label(geo_region, client_lang) }}</h4>
      </div>
      <div class="col-md-8">
        {{ cr.tag_vocab_field(geo_region, pkg, client_lang) }}
      </div>

  {% endif %}
</div>
{% endif %}
{% endblock %}

{% block package_comments %}
{% include "package/comments.html" %}
{% endblock %}

{% block page_extra_scripts %}
<!--[if gte IE 9 | !IE ]><!-->
<script src="{{ wet_server }}/geomapzoom.js" type="text/javascript"></script>
<!--<![endif]--><!--[if lt IE 9]>
<script src="{{ wet_server }}/geomapzoom.js"></script>
<![endif]-->
{% endblock %}



