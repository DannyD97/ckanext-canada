{# vim: set filetype=jinja sw=2 sts=2: #}
{% ckan_extends %}
{% import 'macros/canada_read.html' as cr %}

{% set pkg = c.pkg_dict %}
{% set client_lang = h.lang() %}

{% block subtitle %}{{ cr.field_id('title', pkg, client_lang) }}{% endblock %}


{% block package_item_title %}
<div class="col-md-12">
  <h3>{{ cr.field_id('title', pkg, client_lang) or pkg.name }}
    {% if pkg.state.startswith('draft') %}
      [{{ _('Draft') }}]
    {% endif %}
  </h3>
</div>
{% endblock %}

{% block package_item_notes %}
{% if c.pkg_notes_formatted %}
  <div class="col-md-12">
    {{ cr.field_id('notes', pkg, client_lang) }}
  </div>
{% endif %}
{% endblock %}

{% block package_item_license_inner %}
{% if client_lang == 'fr' %}
  <a href="{{ pkg.license_url_fra }}">{{ pkg.license_title_fra }}</a>
{% else %}
  <a href="{{ pkg.license_url }}">{{ pkg.license_title }}</a>
{% endif %}
{% endblock %}

{% block package_item_apps %}
<div class="col-md-12">
  {% set apps = [] %}
  {% for resource in pkg.resources %}
    {% if resource.format == 'app' %}
      {% do apps.append(resource) %}
    {% endif %}
  {% endfor %}
</div>
{% endblock %}

{% if apps|length > 0 %}
<div class="col-md-12">
  <h4>{{ _('Related Items') }}</h4>
  <ul class="list-unstyled">
  {% for resource in apps %}
    {% snippet 'package/snippets/app_item.html',
        pkg=pkg, res=resource, res_num=loop.index, client_lang=client_lang %}
  {% endfor %}
  </ul>
</div>
{% endif %}

{% block package_item_geo_preview %}
{% if pkg.geographic_region or pkg.spatial %}
<div class="col-md-12">
  <h4>{{ _('Geographic Information') }}</h4>
  {% if pkg.spatial %}
    {% set wkt = h.geojson_to_wkt(pkg.spatial) %}
    {% if wkt %}
      {% if h.get_map_type() == 'static' %}

        {% snippet 'snippets/geomap_static.html', gid=cr.field_id('title', pkg, client_lang), wkt=wkt %}
      {% else %}
        {% snippet 'snippets/geomap_dynamic.html', gid=cr.field_id('title', pkg, client_lang), wkt=wkt %}
      {% endif %}
    {% endif %}
  {% endif %}
  {% if pkg.geographic_region %}
    {% set geo_region = schema_description.dataset_field_by_id['geographic_region'] %}

      <div class="col-md-4">
        <h4>{{ cr.field_label(geo_region, client_lang) }}</h4>
      </div>
      <div class="col-md-8">
        {{ cr.tag_vocab_field(geo_region, pkg, client_lang) }}
      </div>

  {% endif %}
</div>
{% endif %}
{% endblock %}

{#
    <table class="table table-striped table-bordered table-condensed span-6">
      <thead>
        <tr>
          <th scope="col">Field</th>
          <th scope="col">Value</th>
        </tr>
      </thead>
      <tbody>
      {% for f in schema_description.dataset_fields %}
        {% if f.id not in ('title', 'name', 'language', 'author_email',
          'portal_release_date' ) %}
          <tr>
            <td>
              <strong>{{ cr.field_label(f, client_lang) }}</strong>:
            </td>
            <td>
            {%- if f.type == 'keywords' -%}
              {{ cr.keyword_field(f, pkg, client_lang) }}

            {%- elif f.type == 'tag_vocabulary' -%}
              {{ cr.tag_vocab_field(f, pkg, client_lang) }}

            {%- elif f.type == 'url' -%}
              {{ cr.url_field(f, pkg) }}

            {%- elif f.type == 'boolean' -%}
              {{ cr.bool_field(f, pkg) }}

            {%- elif f.id == 'owner_org' -%}
              {{ cr.org_field(pkg, client_lang) }}

            {%- else -%}
              {{ cr.field(f, pkg, client_lang) }}
            {%- endif -%}
            </td>
          </tr>
        {% endif %}
      {% endfor %}
        <tr>
          <td>
            <strong>{{ _('Openness rating') }}</strong>:
          </td>
          <td>
            {% for star in range(h.openness_score(pkg)) -%}
              *
            {%- endfor %}
          </td>
        </tr>
      </tbody>
    </table>
  
#}
  </div>

{% block drupal_comments %}
{% include "package/comments.html" %}
{% endblock drupal_comments %}

{% block page_extra_scripts %}

    <!--[if gte IE 9 | !IE ]><!-->
    <script src="/geomapzoom.js" type="text/javascript"></script>
    <!--<![endif]--><!--[if lt IE 9]>
    <script src="/geomapzoom.js"></script>
    <![endif]-->

{% endblock %}



